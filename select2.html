<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grouped Data Tables</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        #searchBar {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Grouped Data Tables</h1>
        <!-- Search bar -->
        <input type="text" id="searchBar" placeholder="Search Ransomware Group name..." oninput="searchRansomwareName()">
    </header>
    <main>
        <!-- JavaScript will populate these tables -->
    </main>

    <script>
        // Function to extract query parameters
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        let data = []; // Store JSON data

        fetch('Groups/Overall_data/data_post.json')
            .then(response => response.json())
            .then(jsonData => {
                data = jsonData; // Store JSON data
                populateTables(); // Populate tables based on query parameter or all data
            })
            .catch(error => {
                console.error('Error fetching JSON data:', error);
            });

        function populateTables() {
            const groupedData = {};

            // Get the Ransomware Name from the query parameter
            const ransomwareParam = getQueryParam('ransomware');
            const searchTerm = ransomwareParam ? decodeURIComponent(ransomwareParam).toLowerCase() : '';

            data.forEach(entry => {
                const ransomwareName = entry.ransomware_name;
                if (!groupedData[ransomwareName]) {
                    groupedData[ransomwareName] = [];
                }
                groupedData[ransomwareName].push({
                    company: entry.company,
                    data_date: entry.data_date
                });
            });

            const mainElement = document.querySelector('main');
            mainElement.innerHTML = ''; // Clear the main content

            for (const ransomwareName in groupedData) {
                if (groupedData.hasOwnProperty(ransomwareName) && (searchTerm === '' || ransomwareName.toLowerCase().includes(searchTerm))) {
                    const filteredTable = document.createElement('table');
                    const tbody = document.createElement('tbody');

                    // Add table title
                    const caption = document.createElement('caption');
                    caption.textContent = ransomwareName;
                    filteredTable.appendChild(caption);

                    // Populate the table body
                    groupedData[ransomwareName].forEach(entry => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><a href="company_data.html?company=${encodeURIComponent(entry.company)}" target="_blank">${entry.company}</a></td>
                            <td>${entry.data_date}</td>
                        `;
                        tbody.appendChild(row);
                    });

                    filteredTable.appendChild(tbody);
                    mainElement.appendChild(filteredTable);
                }
            }
        }

        // Function to Search Ransomware Group_name
        function searchRansomwareName() {
            populateTables(); // Update the tables based on the current search bar value
        }
    </script>
</body>
</html>
